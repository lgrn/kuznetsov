#
# DO NOT EDIT THIS FILE
#

# cloud-config data structure generated by ansible, using hostvars

cloud_config:
{% for container in groups['lxd_containers'] %}
{% set c = hostvars[container] %}
  {{ container }}:
    #cloud-config
    timezone: "{{ c['timezone'] }}"
    write_files:
      - path: "/etc/apt/sources.list"
        content: |
          deb http://mirror.hetzner.com/ubuntu/packages jammy main restricted universe multiverse
          deb http://mirror.hetzner.com/ubuntu/packages jammy-updates main restricted universe multiverse
          deb http://mirror.hetzner.com/ubuntu/packages jammy-backports main restricted universe multiverse
          deb http://mirror.hetzner.com/ubuntu/packages jammy-security main restricted universe multiverse
    packages: {{ c['packages'] }}
    users:
      - name: "root"
        ssh_authorized_keys: {{ c['authorized_keys'] }}
        groups: ['sudo']
        sudo: ['ALL=(ALL) NOPASSWD:ALL']
        shell: "/bin/bash"
{% endfor %}

network_config:
{% for container in groups['lxd_containers'] %}
{% set c = hostvars[container] %}
  {{ container }}:
    version: 1
    config:
      - type: "physical"
        name: "eth0"
        subnets:
          - type: "static"
            ipv4: true
            address: "{{ c['ip'] | ansible.utils.ipaddr('address') }}"
            netmask: "{{ c['ip'] | ansible.utils.ipaddr('netmask') }}"
            gateway: "{{ c['ip'] | ansible.utils.nthhost(1) }}"
            control: "auto"
      - type: "nameserver"
        address: "{{ c['dns'] }}"
{% endfor %}
